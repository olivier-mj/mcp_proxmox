services:
  mcp-proxmox:
    build: .
    image: oliviermj/mcp_proxmox:latest
    container_name: mcp-proxmox
    env_file:
      - .env
    restart: unless-stopped
    # Le serveur MCP communique via stdio (JSON-RPC).
    # stdin_open est nécessaire pour garder le canal de communication ouvert.
    stdin_open: true
    # tty est volontairement désactivé pour éviter les interférences avec le format JSON.
    tty: false

  lobe-plugin:
    build: .
    image: oliviermj/mcp_proxmox:latest
    container_name: mcp-proxmox-plugin
    env_file:
      - .env
    restart: unless-stopped
    command: uvicorn src.api:app --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000"